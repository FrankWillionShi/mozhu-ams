# MOZHU-AMS

#### 介绍
这是一个DIY 3D打印多色供料系统的项目，主要针对的是拓竹的P1系列，理论上X1系列也是可以用的。
![输入图片说明](https://foruda.gitee.com/images/1711896480715863898/b55ce9f5_10373519.jpeg "完整效果")
这是项目第一次测试通过并且实现自动换料打印时拍摄的完整系统图片  
![输入图片说明](https://foruda.gitee.com/images/1711896581383345310/527d4843_10373519.jpeg "1.jpg")

#### 引用项目
该项目引用了B站up主不死鳥の守り的DIY AMS项目，非常感谢他开源的基于拓竹MQTT接口进行通信的设计方案和硬件结构设计，本方案才能最终落地  

![输入图片说明](https://foruda.gitee.com/images/1711894690895476931/8329886d_10373519.png "屏幕截图")  
在本项目中，引用了这位UP主的AMS模型设计（1.2版）和拓竹MQTT的部分指令，模型设计在本开源项目的hardware文件夹中的AMS组件.3mf中，MQTT指令在代码中有所体现。




#### 项目说明

1.  本项目使用无上位机的设计，使用合宙esp32C3核心板作为主控，理论上一个主控可以控制最多四个通道的耗材。
2.  本项目为开源项目，欢迎所有对此感兴趣的人一起建设。
3.  本项目还有许多不完善的地方，日后会陆续完善，欢迎大家批评指导。



#### 文件说明

1.  hardware文件夹中包含了引用的AMS进退料组件模型，进料缓冲器模型和断料检测模型，五通受限于本人建模技术较差，是买的成品，理论上可以直接买一个A1的五通拿来用。
2.  software文件夹中包含了本项目中使用到的代码，其中filamentChange.gcode是用来替换拓竹的换料GCODE的，直接在打印机设置中复制替换就可以，主要作用是降低换料过程的复杂性，这段代码可以让打印机完成切料、退料、进料、冲洗。请注意，直接编写GCODE控制打印机是很危险的，操作不当会有很大可能导致打印机出现机械故障，所以你如果对3D打印机的gcode没有深入了解，请尽量不要做修改。software中的AMSwithESP32是本项目的代码，基于Arduino IDE编写，其中包含了一个defines.h，这个文件中包含着用户设置，使用前请在这里设置wifi SSID、密码、打印机IP、打印机的链接授权码（八位数字）以及使用的通道数量，请尽可能不要修改除user setting以外的其他设置，否则有可能导致代码无法正常运行。
3.bambu_ca.pem是本开原作者提取到自己打印机中的CA证书，并用其生成了finger point来连接打印机，如果你连上网以后无法连接到打印机的MQTT端口，在确认IP没有出错的前提下，可以使用以下指令来生成finger point并对代码进行修改：  
openssl s_client -connect your_server_address:port -showcerts | openssl x509 -noout -fingerprint
